#!/bin/bash

set -e

echo "üîß Criar ambiente virtual em ~/env-cu113..."
python3 -m venv ~/env-cu113
source ~/env-cu113/bin/activate

echo "‚¨ÜÔ∏è Atualizar pip e instalar PyTorch com suporte a CUDA 11.3..."
pip install --upgrade pip
pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 torchaudio==0.12.1 \
  --extra-index-url https://download.pytorch.org/whl/cu113

echo "üß† Instalar TensorFlow 2.10 com NumPy compat√≠vel..."
pip install "numpy<2.0"
pip install tensorflow==2.10

echo "üìö Instalar JupyterLab e bibliotecas √∫teis..."
pip install jupyterlab ipykernel ipywidgets matplotlib pandas

echo "üîó Registar kernel no Jupyter..."
python -m ipykernel install --user --name=env-cu113 --display-name "Python (cu113)"

echo "üß™ Criar ficheiro de teste..."
cat > test.py << 'EOF'
import torch
print("CUDA dispon√≠vel:", torch.cuda.is_available())
if torch.cuda.is_available():
    print("Nome da GPU:", torch.cuda.get_device_name(0))
    print("N√∫mero de GPUs:", torch.cuda.device_count())
    print("Vers√£o do driver CUDA:", torch.version.cuda)
    print("Vers√£o do PyTorch:", torch.__version__)
import tensorflow as tf
print("TensorFlow version:", tf.__version__)
print("GPU dispon√≠vel:", tf.config.list_physical_devices('GPU'))
EOF

echo ""
echo "‚úÖ Ambiente configurado!"
echo "üëâ Ativa com: source ~/env-cu113/bin/activate"
echo "üëâ Corre o teste com: python test.py"
echo "üëâ Inicia o JupyterLab com: jupyter lab"


python train.py --img 640 --batch 16 --epochs 50 --data capacete.yaml --weights yolov5s.pt --name capacete
python detect.py --weights runs/train/exp/weights/best.pt --img 640 --source /home/djoker/code/cuda/capacete/images/train/Qual-a-funcao-do-capacete-de-protecao-1024x535-1.jpg
python train.py --img 640 --batch 4 --epochs 100 --data data.yaml --weights yolov5s.pt
python detect.py --weights runs/train/exp/weights/best.pt --img 640 --source video.mp4


python detect.py --weights runs/train/yolo_portagem/weights/best.pt --/home/djoker/code/pyhon/udacity/portagens.mp4 --conf 0.4
python train.py --img 640 --batch 4 --epochs 100 --data portagem.yaml --weights yolov5s.pt --name yolo_portagem
python train.py --img 640 --batch 4 --epochs 100 --data portagem.yaml --weights yolov5s.pt --name portagem_yolo --cache

/home/djoker/code/pyhon/udacity/portagens.mp4
